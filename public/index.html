<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatApp - Modern Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              "primary-dark": "#2563eb",
              "primary-light": "#60a5fa",
            },
            borderRadius: {
              "2xl": "1rem",
              "3xl": "1.5rem",
              "4xl": "2rem",
            },
          },
        },
      };
    </script>
    <style>
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .glass-effect {
        backdrop-filter: blur(16px);
        background: rgba(255, 255, 255, 0.1);
      }
      .online-indicator {
        position: relative;
      }
      .online-indicator::after {
        content: "";
        position: absolute;
        bottom: 0;
        right: 0;
        width: 14px;
        height: 14px;
        background: #10b981;
        border: 2px solid white;
        border-radius: 50%;
      }
      .offline-indicator::after {
        background: #6b7280;
      }
    </style>
  </head>
  <body class="h-full bg-gray-50" x-data="chatApp()">
    <!-- Login/Register Pages -->
    <div
      x-show="currentView === 'login'"
      class="min-h-screen bg-primary flex items-center justify-center px-4"
    >
      <div class="max-w-md w-full">
        <div
          class="glass-effect rounded-4xl p-8 shadow-2xl border border-white/20"
        >
          <div class="text-center">
            <div
              class="mx-auto h-20 w-20 bg-white rounded-full flex items-center justify-center mb-6 shadow-lg"
            >
              <svg
                class="h-10 w-10 text-primary"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M8.5 12l1.5 1.5L14.5 9M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"
                />
              </svg>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Welcome Back</h2>
            <p class="text-white/80 mb-8">Sign in to continue chatting</p>
          </div>

          <form class="space-y-6" @submit.prevent="login">
            <div class="space-y-4">
              <div>
                <input
                  x-model="loginForm.email"
                  type="email"
                  required
                  class="w-full px-6 py-4 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200 text-lg"
                  placeholder="Email address"
                />
              </div>
              <div>
                <input
                  x-model="loginForm.password"
                  type="password"
                  required
                  class="w-full px-6 py-4 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200 text-lg"
                  placeholder="Password"
                />
              </div>
            </div>

            <button
              type="submit"
              class="w-full bg-white text-primary py-4 px-6 rounded-2xl hover:bg-gray-50 focus:ring-4 focus:ring-white/50 transition-all duration-200 font-semibold text-lg"
            >
              Sign In
            </button>

            <div class="text-center">
              <button
                type="button"
                @click="currentView = 'register'"
                class="text-white/80 hover:text-white transition-colors"
              >
                Don't have an account? Sign up
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Register Page -->
    <div
      x-show="currentView === 'register'"
      class="min-h-screen bg-primary flex items-center justify-center px-4"
    >
      <div class="max-w-md w-full">
        <div
          class="glass-effect rounded-4xl p-8 shadow-2xl border border-white/20"
        >
          <div class="text-center">
            <div
              class="mx-auto h-20 w-20 bg-white rounded-full flex items-center justify-center mb-6 shadow-lg"
            >
              <svg
                class="h-10 w-10 text-primary"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M8.5 12l1.5 1.5L14.5 9M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"
                />
              </svg>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Create Account</h2>
            <p class="text-white/80 mb-8">Join and start messaging</p>
          </div>

          <form class="space-y-6" @submit.prevent="register">
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <input
                  x-model="registerForm.firstName"
                  type="text"
                  required
                  class="px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="First name"
                />
                <input
                  x-model="registerForm.lastName"
                  type="text"
                  required
                  class="px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="Last name"
                />
              </div>
              <div>
                <input
                  x-model="registerForm.username"
                  type="text"
                  required
                  class="w-full px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="Username"
                />
              </div>
              <div>
                <input
                  x-model="registerForm.email"
                  type="email"
                  required
                  class="w-full px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="Email address"
                />
              </div>
              <div>
                <input
                  x-model="registerForm.password"
                  type="password"
                  required
                  class="w-full px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="Password"
                />
              </div>
              <div>
                <input
                  x-model="registerForm.confirmPassword"
                  type="password"
                  required
                  class="w-full px-4 py-3 border-0 rounded-2xl focus:ring-4 focus:ring-white/50 focus:outline-none transition-all duration-200"
                  placeholder="Confirm password"
                />
              </div>
            </div>

            <button
              type="submit"
              class="w-full bg-white text-primary py-4 px-6 rounded-2xl hover:bg-gray-50 focus:ring-4 focus:ring-white/50 transition-all duration-200 font-semibold"
            >
              Create Account
            </button>

            <div class="text-center">
              <button
                type="button"
                @click="currentView = 'login'"
                class="text-white/80 hover:text-white transition-colors"
              >
                Already have an account? Sign in
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Main Chat Interface -->
    <div
      x-show="currentView === 'chat'"
      class="h-screen flex bg-gray-50 overflow-hidden"
    >
      <!-- Sidebar -->
      <div
        class="w-full md:w-80 bg-white border-r border-gray-200 flex flex-col"
        x-show="!selectedChat || window.innerWidth >= 768"
      >
        <!-- Header -->
        <div
          class="p-6 border-b border-gray-200 bg-primary text-white flex-shrink-0"
        >
          <div class="flex items-center justify-between">
            <div
              class="flex items-center space-x-4 cursor-pointer"
              @click="showProfileModal = true"
            >
              <div
                class="h-12 w-12 bg-white rounded-full flex items-center justify-center online-indicator"
              >
                <span
                  class="text-primary font-semibold text-lg"
                  x-text="user.firstName.charAt(0)"
                ></span>
              </div>
              <div>
                <h2
                  class="font-semibold text-lg"
                  x-text="user.firstName + ' ' + user.lastName"
                ></h2>
                <p class="text-xs text-blue-100">
                  @<span x-text="user.username"></span>
                </p>
              </div>
            </div>
            <div class="flex space-x-2">
              <button
                @click="showNewChatModal = true"
                class="p-3 hover:bg-white/10 rounded-2xl transition-all duration-200"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  />
                </svg>
              </button>
              <button
                @click="logout"
                class="p-3 hover:bg-white/10 rounded-2xl transition-all duration-200"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Search -->
        <div class="p-6 border-b border-gray-100 flex-shrink-0">
          <div class="relative">
            <input
              x-model="searchQuery"
              type="text"
              class="w-full pl-12 pr-4 py-3 bg-gray-100 rounded-2xl focus:outline-none focus:ring-4 focus:ring-primary/20 focus:bg-white transition-all duration-200"
              placeholder="Search conversations"
            />
            <svg
              class="absolute left-4 top-3.5 h-5 w-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>
        </div>

        <!-- Chat List -->
        <div class="flex-1 overflow-y-auto scrollbar-hide">
          <template x-for="chat in filteredChats" :key="chat.id">
            <div
              @click="selectChat(chat)"
              class="flex items-center p-4 hover:bg-gray-50 cursor-pointer transition-all duration-200"
              :class="{'bg-primary/5 border-r-4 border-primary': selectedChat?.id === chat.id}"
            >
              <div
                class="h-14 w-14 rounded-full flex-shrink-0 flex items-center justify-center relative"
                :class="[chat.isOnline ? 'bg-primary online-indicator' : 'bg-gray-400 offline-indicator']"
              >
                <span
                  class="text-white font-semibold text-lg"
                  x-text="chat.name.charAt(0)"
                ></span>
              </div>
              <div class="ml-4 flex-1 min-w-0">
                <div class="flex items-center justify-between mb-1">
                  <h3
                    class="font-semibold text-gray-900 truncate"
                    x-text="chat.name"
                  ></h3>
                  <span
                    class="text-xs text-gray-500"
                    x-text="formatTime(chat.lastMessage?.timestamp)"
                  ></span>
                </div>
                <p
                  class="text-sm text-gray-600 truncate"
                  x-text="chat.lastMessage?.content || 'No messages yet'"
                ></p>
              </div>
              <div
                x-show="chat.unreadCount > 0"
                class="ml-3 bg-primary text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-medium"
              >
                <span x-text="chat.unreadCount"></span>
              </div>
            </div>
          </template>
        </div>
      </div>

      <!-- Chat Area -->
      <div
        class="flex-1 flex flex-col overflow-hidden"
        x-show="selectedChat || window.innerWidth >= 768"
      >
        <div
          x-show="!selectedChat"
          class="flex-1 flex items-center justify-center bg-gray-50"
        >
          <div class="text-center text-gray-500">
            <div
              class="mx-auto h-24 w-24 bg-gray-200 rounded-full flex items-center justify-center mb-6"
            >
              <svg
                class="h-12 w-12 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                />
              </svg>
            </div>
            <h3 class="text-xl font-medium mb-2">
              Select a chat to start messaging
            </h3>
            <p class="text-gray-400">
              Choose a conversation from the sidebar to begin
            </p>
          </div>
        </div>

        <div x-show="selectedChat" class="flex-1 flex flex-col overflow-hidden">
          <!-- Chat Header -->
          <div
            class="bg-white border-b border-gray-200 px-6 py-4 flex-shrink-0"
          >
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <button
                  @click="selectedChat = null"
                  class="md:hidden p-2 hover:bg-gray-100 rounded-2xl"
                >
                  <svg
                    class="h-5 w-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    />
                  </svg>
                </button>
                <div
                  class="h-12 w-12 rounded-full flex-shrink-0 flex items-center justify-center cursor-pointer relative"
                  :class="[selectedChat?.isOnline ? 'bg-primary online-indicator' : 'bg-gray-400 offline-indicator']"
                  @click="showUserInfo = true"
                >
                  <span
                    class="text-white font-semibold text-lg"
                    x-text="selectedChat?.name.charAt(0)"
                  ></span>
                </div>
                <div class="cursor-pointer" @click="showUserInfo = true">
                  <h3
                    class="font-semibold text-gray-900 text-lg"
                    x-text="selectedChat?.name"
                  ></h3>
                  <p
                    class="text-sm"
                    :class="selectedChat?.isOnline ? 'text-green-500' : 'text-gray-500'"
                    x-text="selectedChat?.isOnline ? 'Online' : 'Offline'"
                  ></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Messages -->
          <div
            class="flex-1 overflow-y-auto p-6 space-y-4 scrollbar-hide bg-gray-50"
            x-ref="messagesContainer"
          >
            <template
              x-for="message in selectedChat?.messages || []"
              :key="message.id"
            >
              <div
                class="flex"
                :class="message.sent ? 'justify-end' : 'justify-start'"
              >
                <div
                  class="max-w-xs lg:max-w-md px-4 py-3 rounded-3xl shadow-sm"
                  :class="message.sent ? 'bg-primary text-white' : 'bg-white text-gray-800 border border-gray-200'"
                >
                  <p x-text="message.content" class="leading-relaxed"></p>
                  <div class="flex items-center justify-end mt-2 space-x-1">
                    <span
                      class="text-xs opacity-70"
                      x-text="formatTime(message.timestamp)"
                    ></span>
                    <div x-show="message.sent" class="flex space-x-1">
                      <svg
                        x-show="message.status === 'sent'"
                        class="h-3 w-3 opacity-70"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      <svg
                        x-show="message.status === 'delivered'"
                        class="h-3 w-3 opacity-70"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      <svg
                        x-show="message.status === 'read'"
                        class="h-3 w-3 text-blue-200"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>

          <!-- Message Input -->
          <div class="bg-white border-t border-gray-200 p-6 flex-shrink-0">
            <form
              @submit.prevent="sendMessage"
              class="flex items-end space-x-4"
            >
              <div class="flex-1">
                <textarea
                  x-model="newMessage"
                  class="w-full px-4 py-3 bg-gray-100 rounded-3xl focus:outline-none focus:ring-4 focus:ring-primary/20 focus:bg-white transition-all duration-200 resize-none"
                  placeholder="Write a message..."
                  rows="1"
                  @input="autoResize($event)"
                  @keydown.enter.prevent="if (!$event.shiftKey) { sendMessage() }"
                  style="min-height: 48px; max-height: 120px"
                ></textarea>
              </div>
              <button
                type="submit"
                class="p-3 bg-primary text-white rounded-full hover:bg-primary-dark focus:ring-4 focus:ring-primary/20 transition-all duration-200 flex-shrink-0"
                :disabled="!newMessage.trim()"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                  />
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Edit Modal -->
    <div
      x-show="showProfileModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 overflow-y-auto"
      @click.away="showProfileModal = false"
    >
      <div
        class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        ></div>

        <div
          class="inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
        >
          <div class="bg-white px-6 py-6">
            <div class="flex items-center justify-between mb-8">
              <h3 class="text-xl font-semibold text-gray-900">Edit Profile</h3>
              <button
                @click="showProfileModal = false"
                class="text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-2xl transition-all duration-200"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <div class="text-center mb-8">
              <div
                class="h-24 w-24 mx-auto bg-primary rounded-full flex items-center justify-center mb-4 online-indicator"
              >
                <span
                  class="text-white text-3xl font-semibold"
                  x-text="user.firstName.charAt(0)"
                ></span>
              </div>
              <button class="text-primary hover:text-primary-dark font-medium">
                Change Picture
              </button>
            </div>

            <form @submit.prevent="updateProfile" class="space-y-6">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >First Name</label
                  >
                  <input
                    x-model="editProfile.firstName"
                    type="text"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-200"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Last Name</label
                  >
                  <input
                    x-model="editProfile.lastName"
                    type="text"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-200"
                  />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Username</label
                >
                <input
                  x-model="editProfile.username"
                  type="text"
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-200"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Bio</label
                >
                <textarea
                  x-model="editProfile.bio"
                  class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-200 resize-none"
                  rows="3"
                  placeholder="Tell us about yourself..."
                ></textarea>
              </div>

              <div class="flex space-x-4 pt-4">
                <button
                  type="button"
                  @click="showProfileModal = false"
                  class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-2xl hover:bg-gray-50 transition-all duration-200"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="flex-1 px-6 py-3 bg-primary text-white rounded-2xl hover:bg-primary-dark transition-all duration-200"
                >
                  Save Changes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- User Info Modal -->
    <div
      x-show="showUserInfo"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 overflow-y-auto"
      @click.away="showUserInfo = false"
    >
      <div
        class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        ></div>

        <div
          class="inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
        >
          <div class="bg-white px-6 py-6">
            <div class="flex items-center justify-between mb-8">
              <h3 class="text-xl font-semibold text-gray-900">User Info</h3>
              <button
                @click="showUserInfo = false"
                class="text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-2xl transition-all duration-200"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <div class="text-center mb-8">
              <div
                class="h-24 w-24 mx-auto rounded-full flex items-center justify-center mb-4 relative"
                :class="[selectedChat?.isOnline ? 'bg-primary online-indicator' : 'bg-gray-400 offline-indicator']"
              >
                <span
                  class="text-white text-3xl font-semibold"
                  x-text="selectedChat?.name.charAt(0)"
                ></span>
              </div>
              <h2
                class="text-2xl font-semibold text-gray-900"
                x-text="selectedChat?.name"
              ></h2>
              <p
                class="text-lg mt-1"
                :class="selectedChat?.isOnline ? 'text-green-500' : 'text-gray-500'"
                x-text="selectedChat?.isOnline ? 'Online' : 'Offline'"
              ></p>
            </div>

            <div class="space-y-3">
              <div
                class="flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-2xl cursor-pointer transition-all duration-200"
              >
                <div
                  class="h-12 w-12 bg-gray-100 rounded-2xl flex items-center justify-center"
                >
                  <svg
                    class="h-6 w-6 text-gray-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                    />
                  </svg>
                </div>
                <span class="text-gray-700 font-medium">Block User</span>
              </div>

              <div
                class="flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-2xl cursor-pointer transition-all duration-200 text-red-600"
              >
                <div
                  class="h-12 w-12 bg-red-50 rounded-2xl flex items-center justify-center"
                >
                  <svg
                    class="h-6 w-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    />
                  </svg>
                </div>
                <span class="font-medium">Delete Chat</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- New Chat Modal -->
    <div
      x-show="showNewChatModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 overflow-y-auto"
      @click.away="showNewChatModal = false"
    >
      <div
        class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <div
          class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
        ></div>

        <div
          class="inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
        >
          <div class="bg-white px-6 py-6">
            <div class="flex items-center justify-between mb-8">
              <h3 class="text-xl font-semibold text-gray-900">New Chat</h3>
              <button
                @click="showNewChatModal = false"
                class="text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-2xl transition-all duration-200"
              >
                <svg
                  class="h-6 w-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <div class="mb-6">
              <input
                x-model="newChatSearch"
                type="text"
                class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-primary/20 focus:border-primary transition-all duration-200"
                placeholder="Search users..."
              />
            </div>

            <div class="space-y-2 max-h-80 overflow-y-auto scrollbar-hide">
              <template
                x-for="user in availableUsers.filter(u => u.name.toLowerCase().includes(newChatSearch.toLowerCase()))"
                :key="user.id"
              >
                <div
                  @click="startNewChat(user)"
                  class="flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-2xl cursor-pointer transition-all duration-200"
                >
                  <div
                    class="h-12 w-12 rounded-full flex-shrink-0 flex items-center justify-center relative"
                    :class="[user.isOnline ? 'bg-primary online-indicator' : 'bg-gray-400 offline-indicator']"
                  >
                    <span
                      class="text-white font-semibold"
                      x-text="user.name.charAt(0)"
                    ></span>
                  </div>
                  <div class="flex-1">
                    <h4
                      class="font-medium text-gray-900"
                      x-text="user.name"
                    ></h4>
                    <p
                      class="text-sm"
                      :class="user.isOnline ? 'text-green-500' : 'text-gray-500'"
                      x-text="user.isOnline ? 'Online' : 'Offline'"
                    ></p>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Alpine.js Data -->
    <script>
      function chatApp() {
        return {
          currentView: "login", // 'login', 'register', 'chat'
          user: {},
          loginForm: {
            email: "",
            password: "",
          },
          registerForm: {
            firstName: "",
            lastName: "",
            username: "",
            email: "",
            password: "",
            confirmPassword: "",
          },
          editProfile: {
            firstName: "",
            lastName: "",
            username: "",
            bio: "",
          },
          chats: [
            {
              id: 1,
              name: "Alice Johnson",
              isOnline: true,
              unreadCount: 2,
              lastMessage: {
                content: "Hey! How are you doing?",
                timestamp: new Date(Date.now() - 5 * 60000), // 5 minutes ago
              },
              messages: [
                {
                  id: 1,
                  content: "Hello there!",
                  sent: false,
                  timestamp: new Date(Date.now() - 30 * 60000),
                  status: "read",
                },
                {
                  id: 2,
                  content: "Hi Alice! How are you?",
                  sent: true,
                  timestamp: new Date(Date.now() - 25 * 60000),
                  status: "read",
                },
                {
                  id: 3,
                  content:
                    "I'm doing great! Just finished working on a new project. It's been really exciting to see everything come together.",
                  sent: false,
                  timestamp: new Date(Date.now() - 20 * 60000),
                  status: "read",
                },
                {
                  id: 4,
                  content:
                    "That's awesome! What kind of project? I'd love to hear more about it.",
                  sent: true,
                  timestamp: new Date(Date.now() - 15 * 60000),
                  status: "read",
                },
                {
                  id: 5,
                  content:
                    "A new chat application with modern UI design. We've been focusing on making it really user-friendly and responsive.",
                  sent: false,
                  timestamp: new Date(Date.now() - 10 * 60000),
                  status: "read",
                },
                {
                  id: 6,
                  content: "Hey! How are you doing?",
                  sent: false,
                  timestamp: new Date(Date.now() - 5 * 60000),
                  status: "delivered",
                },
              ],
            },
            {
              id: 2,
              name: "Bob Wilson",
              isOnline: false,
              unreadCount: 0,
              lastMessage: {
                content: "Thanks for the help!",
                timestamp: new Date(Date.now() - 2 * 60 * 60000), // 2 hours ago
              },
              messages: [
                {
                  id: 1,
                  content:
                    "Can you help me with the backend setup? I'm having some issues with the database configuration.",
                  sent: false,
                  timestamp: new Date(Date.now() - 3 * 60 * 60000),
                  status: "read",
                },
                {
                  id: 2,
                  content:
                    "Sure! What specific issues are you running into? I can walk you through the setup process.",
                  sent: true,
                  timestamp: new Date(Date.now() - 2.5 * 60 * 60000),
                  status: "read",
                },
                {
                  id: 3,
                  content: "Thanks for the help!",
                  sent: false,
                  timestamp: new Date(Date.now() - 2 * 60 * 60000),
                  status: "read",
                },
              ],
            },
            {
              id: 3,
              name: "Sarah Davis",
              isOnline: true,
              unreadCount: 5,
              lastMessage: {
                content: "Can we schedule a meeting tomorrow?",
                timestamp: new Date(Date.now() - 30 * 60000), // 30 minutes ago
              },
              messages: [
                {
                  id: 1,
                  content:
                    "Good morning! Hope you're having a great day so far.",
                  sent: false,
                  timestamp: new Date(Date.now() - 60 * 60000),
                  status: "read",
                },
                {
                  id: 2,
                  content:
                    "Morning Sarah! Yes, it's been productive. How about you?",
                  sent: true,
                  timestamp: new Date(Date.now() - 55 * 60000),
                  status: "read",
                },
                {
                  id: 3,
                  content: "Can we schedule a meeting tomorrow?",
                  sent: false,
                  timestamp: new Date(Date.now() - 30 * 60000),
                  status: "delivered",
                },
              ],
            },
            {
              id: 4,
              name: "Mike Thompson",
              isOnline: false,
              unreadCount: 0,
              lastMessage: {
                content: "See you later!",
                timestamp: new Date(Date.now() - 24 * 60 * 60000), // 1 day ago
              },
              messages: [
                {
                  id: 1,
                  content:
                    "Let's catch up soon, it's been too long since we last talked.",
                  sent: false,
                  timestamp: new Date(Date.now() - 25 * 60 * 60000),
                  status: "read",
                },
                {
                  id: 2,
                  content:
                    "Absolutely! Let me know when you're free this week.",
                  sent: true,
                  timestamp: new Date(Date.now() - 24.5 * 60 * 60000),
                  status: "read",
                },
                {
                  id: 3,
                  content: "See you later!",
                  sent: false,
                  timestamp: new Date(Date.now() - 24 * 60 * 60000),
                  status: "read",
                },
              ],
            },
          ],
          selectedChat: null,
          newMessage: "",
          searchQuery: "",
          showUserInfo: false,
          showNewChatModal: false,
          showProfileModal: false,
          newChatSearch: "",
          availableUsers: [
            { id: 5, name: "Emma Brown", isOnline: true },
            { id: 6, name: "James Miller", isOnline: false },
            { id: 7, name: "Lisa Garcia", isOnline: true },
            { id: 8, name: "Tom Anderson", isOnline: false },
            { id: 9, name: "Sophie Wilson", isOnline: true },
            { id: 10, name: "David Chen", isOnline: false },
          ],

          get filteredChats() {
            return this.chats.filter((chat) =>
              chat.name.toLowerCase().includes(this.searchQuery.toLowerCase())
            );
          },

          login() {
            if (this.loginForm.email && this.loginForm.password) {
              this.user = {
                id: 1,
                firstName: "John",
                lastName: "Doe",
                username: "johndoe",
                email: this.loginForm.email,
                bio: "Love building amazing apps!",
              };
              this.editProfile = { ...this.user };
              this.currentView = "chat";
              this.loginForm = { email: "", password: "" };
            }
          },

          register() {
            if (
              this.registerForm.password === this.registerForm.confirmPassword
            ) {
              this.user = {
                id: 1,
                firstName: this.registerForm.firstName,
                lastName: this.registerForm.lastName,
                username: this.registerForm.username,
                email: this.registerForm.email,
                bio: "",
              };
              this.editProfile = { ...this.user };
              this.currentView = "chat";
              this.registerForm = {
                firstName: "",
                lastName: "",
                username: "",
                email: "",
                password: "",
                confirmPassword: "",
              };
            } else {
              alert("Passwords do not match!");
            }
          },

          updateProfile() {
            this.user = { ...this.user, ...this.editProfile };
            this.showProfileModal = false;
            // Here you would typically send the update to your backend
          },

          logout() {
            this.user = {};
            this.selectedChat = null;
            this.currentView = "login";
          },

          selectChat(chat) {
            this.selectedChat = chat;
            chat.unreadCount = 0;
            this.scrollToBottom();
          },

          sendMessage() {
            if (this.newMessage.trim() && this.selectedChat) {
              const message = {
                id: Date.now(),
                content: this.newMessage.trim(),
                sent: true,
                timestamp: new Date(),
                status: "sent",
              };

              this.selectedChat.messages.push(message);
              this.selectedChat.lastMessage = {
                content: message.content,
                timestamp: message.timestamp,
              };

              this.newMessage = "";
              this.scrollToBottom();

              // Simulate message status updates
              setTimeout(() => {
                message.status = "delivered";
              }, 1000);

              setTimeout(() => {
                message.status = "read";
              }, 3000);

              // Move chat to top of list
              const chatIndex = this.chats.findIndex(
                (c) => c.id === this.selectedChat.id
              );
              if (chatIndex > 0) {
                const chat = this.chats.splice(chatIndex, 1)[0];
                this.chats.unshift(chat);
              }
            }
          },

          startNewChat(user) {
            const existingChat = this.chats.find(
              (chat) => chat.name === user.name
            );
            if (existingChat) {
              this.selectChat(existingChat);
            } else {
              const newChat = {
                id: Date.now(),
                name: user.name,
                isOnline: user.isOnline,
                unreadCount: 0,
                lastMessage: null,
                messages: [],
              };
              this.chats.unshift(newChat);
              this.selectChat(newChat);
            }
            this.showNewChatModal = false;
            this.newChatSearch = "";
          },

          scrollToBottom() {
            this.$nextTick(() => {
              if (this.$refs.messagesContainer) {
                this.$refs.messagesContainer.scrollTop =
                  this.$refs.messagesContainer.scrollHeight;
              }
            });
          },

          autoResize(event) {
            const textarea = event.target;
            textarea.style.height = "auto";
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + "px";
          },

          formatTime(date) {
            if (!date) return "";

            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) {
              return "now";
            } else if (minutes < 60) {
              return `${minutes}m`;
            } else if (hours < 24) {
              return `${hours}h`;
            } else if (days < 7) {
              return `${days}d`;
            } else {
              return date.toLocaleDateString();
            }
          },

          init() {
            window.addEventListener("resize", () => {
              this.$nextTick();
            });
          },
        };
      }
    </script>
  </body>
</html>
